#!/usr/bin/env bash

set -e

echo "Running pre-commit checks..."

# Get list of staged Ruby files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "\.rb$")

if [[ "$STAGED_FILES" = "" ]]; then
  echo "No Ruby files staged for commit. Skipping RuboCop."
else
  echo "Running RuboCop on staged files..."
  bundle exec rubocop $STAGED_FILES
fi

echo "Running Brakeman security checks..."
bundle exec brakeman -q -z

# Uncomment the following lines if you want to run RSpec tests
# echo "Running RSpec tests..."
# bundle exec rspec

echo "All pre-commit checks passed!"